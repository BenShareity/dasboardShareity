import{a as s,u as ee,r as O,H as le,Q as oe,I as v,M as j,o as C,c as ae,w as r,b as o,g as i,e as u,t as J,d as se,n as _,f as z,X as re,q as ne,O as te,F as ie,h as H,K as ue}from"./index.8eef5a34.js";import{M as ce,c as me,m as de,a0 as V}from"./ServerCall.bf212017.js";import{u as pe}from"./session.f47d2680.js";import{_ as fe}from"./NavBar.1d7fa6fb.js";import{_ as ve}from"./CardBox.b1a10a53.js";import{_ as m}from"./FormField.8a5b2723.js";import{_ as k}from"./FormControl.b755056f.js";import{_ as ge}from"./FormFilePicker.806059ae.js";import{_ as M}from"./BaseButton.060f3a5f.js";import{_ as _e}from"./BaseButtons.7d99a140.js";import{U as ke,_ as ye}from"./LayoutAuthenticated.ccaeb884.js";/* empty css             */import{O as B}from"./OrganizationController.a9249f99.js";import{U as he}from"./utilityMethods.d9c941ff.js";import{s as be}from"./vue-color-kit.esm-bundler.3aec9a2e.js";import{r as Ce}from"./regex.a06b4297.js";import"./numeral.3c5f875f.js";import{R as Ve}from"./RegisterConstroller.4a580cee.js";import{u as Le}from"./alerts.ef7819ba.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./BaseIcon.86eb869a.js";import"./LoginController.5d91ed5e.js";const we={class:"flex justify-between pb-5"},Ee={class:"flex gap-2 items-center"},xe={class:"lg:text-xl text-lg"},Se={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ue={key:0,class:"text-gray-400 leading[19px]"},qe={class:"flex flex-row"},Ne={style:{position:"relative"}},Fe={style:{position:"absolute"}},Re={class:"w-24 h-24"},$e=["src"],Ae={class:"text-lg italic font-bold"},rl={__name:"CreateCauseView",setup(De){let K=pe();const P=Le(),Q=s(!1),T=K.getUserRole(),I="https://chgsdev.shareity.com/",d=s(),b=s(!1),L=s(!1),p=ee(),w=s(null),g=s(null),E=s(null),x=s(null),S=s(null),U=s(null),q=s(!1),y=s(!1),N=s(!1),F=s(!1),R=s(null),$=s(null),t=O({showcolorpicker:!1,color:"#59c7f9",suckerCanvas:null,suckerArea:[],isSucking:!1}),e=O({name:"",personEmail:"",personFirstname:"",personLastname:"",logo:"",description:"",donationLink:"",color:t.color}),A=O({color:"green",message:""}),D=s(!1),f=s({}),h=le(),W=h.query.id?"Edit":"Add",X=a=>{t.color=a.hex},G=a=>{d.value=a};oe(async()=>{f.value=await ke.getMyProfile(),console.log(f.value),B.getById(h.query.id).then(a=>{console.log("edit",a),a&&(L.value=!0,console.log(L.value)),e.name=a.name,e.personEmail=a.personEmail,e.personLastname=a.personLastname,d.value=I+a.logo})},[h.query.id]),v(()=>{console.log(f.value.rol),f.value.rol==="sponsor"?D.value=!e.name||!e.personEmail||!e.personFirstname||!e.personLastname:D.value=!e.name||!e.personEmail||!e.personFirstname||!e.personLastname||!e.donationLink||!e.description}),v(()=>e.name,()=>{e.name?(w.value=null,q.value=!0):(w.value="Required field",q.value=!1)}),v(()=>e.personEmail,async()=>{if(!e.personEmail)g.value="Required field",y.value=!1;else if(!Ce.test(e.personEmail.trim()))g.value="Invalid email",y.value=!1;else{let a={email:e.personEmail};try{let l=await Ve.verifyEmail(a);g.value=null,y.value=!0,console.log("res :>> ",l)}catch(l){console.log(l),g.value=l.message,y.value=!1}}}),v(()=>e.personFirstname,()=>{e.personFirstname?(E.value=null,N.value=!0):(E.value="Required field",N.value=!1)}),v(()=>e.personLastname,()=>{e.personLastname?(x.value=null,F.value=!0):(x.value="Required field",F.value=!1)}),v(()=>e.description,()=>{e.description?(S.value=null,R.value=!0):(S.value="Required field",R.value=!1)}),v(()=>e.donationLink,()=>{e.donationLink?(U.value=null,$.value=!0):(U.value="Required field",$.value=!1)});const Y=async()=>{let a="";if(d.value&&(a=await he.verifyMedia(d.value,"organization")),h.query.id){e.logo=a;let l={name:e.name,personEmail:e.personEmail,personFirstname:e.personFirstname,personLastname:e.personLastname,logo:e.logo,description:e.description,donationLink:e.donationLink,color:e.color};B.update(h.query.id,l).then(c=>{console.log(c),b.value=!0,A.message="Cause Updated",T=="cause"?p==null||p.push("/dashboard"):p==null||p.push("/causes")})}else{e.logo=a;let l=JSON.parse(JSON.stringify(e));B.create(l).then(c=>{console.log(c),c&&(f.value.rol==="admin"?P.createAlert({title:"Cause have been successfully registered",color:"success"}):P.createAlert({title:"Cause have been successfully registered",color:"success",text:"We have successfully invited brand or cause, they will get an invitation email to sign up on Shareity"}),p.push("/causes"))}).catch(c=>{console.error("Error de la consola",c.message)}).finally(()=>{Q.value=!1})}};return(a,l)=>{const c=j("v-btn"),Z=j("v-snackbar");return C(),ae(ye,null,{default:r(()=>[o(fe,null,{default:r(()=>[i("div",we,[i("div",Ee,[o(M,{to:"/causes",icon:u(ce),color:"info","rounded-full":"",small:""},null,8,["icon"]),i("p",xe,J(u(W))+" Cause",1)])]),o(ve,{"is-form":"",class:"col-span-3",onSubmit:se(Y,["prevent"])},{footer:r(()=>[o(_e,{class:"justify-end"},{default:r(()=>[o(M,{color:"info",type:"submit",label:"Save",disabled:D.value||g.value,isloading:a.loading},null,8,["disabled","isloading"])]),_:1})]),default:r(()=>[i("div",Se,[o(m,{label:"Organization Name",err:w.value},{default:r(()=>[o(k,{modelValue:e.name,"onUpdate:modelValue":l[0]||(l[0]=n=>e.name=n),icon:u(me),required:"",class:_([q.value?"clase1 green ":""])},null,8,["modelValue","icon","class"])]),_:1},8,["err"]),o(m,{label:"Contact Person Email",err:g.value},{default:r(()=>[o(k,{modelValue:e.personEmail,"onUpdate:modelValue":l[1]||(l[1]=n=>e.personEmail=n),icon:u(de),type:"email",name:"email",required:"",autocomplete:"email",label:"data",class:_([y.value?"clase2 green ":""])},null,8,["modelValue","icon","class"])]),_:1},8,["err"]),o(m,{label:"Contact Person First Name",err:E.value},{default:r(()=>[o(k,{modelValue:e.personFirstname,"onUpdate:modelValue":l[2]||(l[2]=n=>e.personFirstname=n),icon:u(V),class:_([N.value?"clase1 green ":""])},null,8,["modelValue","icon","class"])]),_:1},8,["err"]),o(m,{label:"Contact Person Last Name",err:x.value},{default:r(()=>[o(k,{modelValue:e.personLastname,"onUpdate:modelValue":l[3]||(l[3]=n=>e.personLastname=n),icon:u(V),class:_([F.value?"clase1 green ":""])},null,8,["modelValue","icon","class"])]),_:1},8,["err"]),f.value.rol==="sponsor"?(C(),z("h2",Ue," *Shareity will send an email to the contact person confirm your request ")):f.value.rol==="admin"||L.value===!0?(C(),z(ie,{key:1},[o(m,{label:"Organization Description",err:S.value},{default:r(()=>[o(k,{modelValue:e.description,"onUpdate:modelValue":l[4]||(l[4]=n=>e.description=n),icon:u(V),class:_([R.value?"clase1 green ":""])},null,8,["modelValue","icon","class"])]),_:1},8,["err"]),o(m,{label:"Donation link",err:U.value},{default:r(()=>[o(k,{modelValue:e.donationLink,"onUpdate:modelValue":l[5]||(l[5]=n=>e.donationLink=n),icon:u(V),class:_([$.value?"clase1 green ":""])},null,8,["modelValue","icon","class"])]),_:1},8,["err"]),o(m,{label:"Organization Color"},{default:r(()=>[i("div",qe,[o(M,{onClick:l[6]||(l[6]=n=>t.showcolorpicker=!t.showcolorpicker),class:"text-black w-full",label:"Select Color"}),i("div",{class:"ml-2 h-12 w-24 rounded-md",style:re({background:t.color})},null,4)]),i("div",Ne,[ne(i("div",Fe,[o(u(be),{theme:"light",color:t.color,"sucker-hide":!1,"sucker-canvas":t.suckerCanvas,"sucker-area":t.suckerArea,onChangeColor:X,onOpenSucker:t.openSucker},null,8,["color","sucker-canvas","sucker-area","onOpenSucker"])],512),[[te,t.showcolorpicker]])])]),_:1}),o(m,{label:"Select Cause Logo"},{default:r(()=>[o(ge,{modelValue:d.value,"onUpdate:modelValue":G,label:"Upload",mediaClass:"h-52 w-52"},null,8,["modelValue"])]),_:1})],64)):H("",!0),i("div",Re,[d.value!=null?(C(),z("img",{key:0,src:u(I)+d.value,alt:""},null,8,$e)):H("",!0)])])]),_:1}),o(Z,{modelValue:b.value,"onUpdate:modelValue":l[8]||(l[8]=n=>b.value=n),timeout:3e3,color:A.color},{actions:r(()=>[o(c,{color:"white",variant:"text",onClick:l[7]||(l[7]=n=>b.value=!1)},{default:r(()=>[ue(" Close ")]),_:1})]),default:r(()=>[i("p",Ae,J(A.message),1)]),_:1},8,["modelValue","color"])]),_:1})]),_:1})}}};export{rl as default};
