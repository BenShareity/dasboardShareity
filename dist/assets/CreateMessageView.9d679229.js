import{a as u,u as x,H as A,r as V,P as C,Q as q,I as B,o as S,c as k,w as o,b as t,g as d,e as m,t as L,d as P}from"./index.8eef5a34.js";import{M as U,c as D,Z as E}from"./ServerCall.bf212017.js";import{_ as I}from"./NavBar.1d7fa6fb.js";import{_ as N}from"./CardBox.b1a10a53.js";import{_ as v}from"./FormField.8a5b2723.js";import{_ as y}from"./FormControl.b755056f.js";import{_ as h}from"./BaseButton.060f3a5f.js";import{_ as R}from"./BaseButtons.7d99a140.js";import{U as w,_ as T}from"./LayoutAuthenticated.ccaeb884.js";/* empty css             */import{u as j}from"./alerts.ef7819ba.js";import{M as b}from"./MessagesController.856a0831.js";import"./session.f47d2680.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./BaseIcon.86eb869a.js";import"./LoginController.5d91ed5e.js";const H={class:"flex justify-between pb-5"},O={class:"flex gap-2 items-center"},J={class:"font-extrabold"},Q={class:"gap-3"},ne={__name:"CreateMessageView",setup(Z){const i=j(),f=u({}),p=u(),c=u(!1),_=x(),a=A(),$=a.query.id?"Edit":"Create",n=u(!1),e=V({title:"",description:""});C(async()=>{f.value=await w.getMyProfile(),p.value=f.value.rol}),q(()=>{e.title=a.query.title,e.description=a.query.description},[a.query.id]),B(()=>{c.value=!e.title||!e.description,console.log(c.value)});const M=async()=>{n.value=!0;let g=f.value.id,l=p.value,s=1;if(l!="admin"&&(s=await w.getCredit(g)),console.log(s),s>0){console.log("aJA",s);try{if(!a.query.id)b.create(e).then(()=>{i.createAlert({title:"Message created sussefully",color:"success",icon:"$success",text:"The message has ben created"}),_.push("/rewards-messages")}).finally(()=>{n.value=!1});else{let r={title:e.title,description:e.description};console.log(r),b.update(a.query.id,r).then(()=>{i.createAlert({title:"Message uodated sussefully",color:"success",icon:"$success",text:"The message has ben updated"}),_.push("/rewards-messages")}).finally(()=>{n.value=!1})}}catch(r){i.createAlert({title:"Error",color:"error",icon:"$warning",text:`${r}, please check your form`}),console.log(r,"Please check our data")}}else console.log("No tienes credito"),i.createAlert({title:"Insufficient credits",color:"error",icon:"$warning",text:"Acquire more credits to create a message"})};return(g,l)=>(S(),k(T,null,{default:o(()=>[t(I,null,{default:o(()=>[d("div",H,[d("div",O,[t(h,{icon:m(U),to:"/rewards-messages",color:"info","rounded-full":"",small:""},null,8,["icon"]),d("p",J,L(m($))+" Message",1)])]),t(N,{"is-form":"",class:"col-span-3",onSubmit:P(M,["prevent"])},{footer:o(()=>[t(R,{class:"justify-end"},{default:o(()=>[t(h,{color:c.value?"infoOpacity":"info",type:"submit",label:"Save",disabled:c.value,isLoading:n.value},null,8,["color","disabled","isLoading"])]),_:1})]),default:o(()=>[d("div",Q,[t(v,{label:"Title"},{default:o(()=>[t(y,{modelValue:e.title,"onUpdate:modelValue":l[0]||(l[0]=s=>e.title=s),icon:m(D)},null,8,["modelValue","icon"])]),_:1}),t(v,{label:"Message"},{default:o(()=>[t(y,{modelValue:e.description,"onUpdate:modelValue":l[1]||(l[1]=s=>e.description=s),icon:m(E)},null,8,["modelValue","icon"])]),_:1})])]),_:1})]),_:1})]),_:1}))}};export{ne as default};
