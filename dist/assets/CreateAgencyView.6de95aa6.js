import{a as r,u as Y,r as M,H as Z,I as v,Q as ee,M as J,o as R,c as le,w as t,b as a,g as n,e as c,t as W,d as ae,n as b,X as oe,q as se,O as te,f as H,h as K,K as re}from"./index.8eef5a34.js";import{M as ie,c as ne,m as ce,a0 as N}from"./ServerCall.bf212017.js";import{u as ue}from"./session.f47d2680.js";import{_ as de}from"./NavBar.1d7fa6fb.js";import{_ as me}from"./CardBox.b1a10a53.js";import{_ as d}from"./FormField.8a5b2723.js";import{_ as h}from"./FormControl.b755056f.js";import{_ as L}from"./FormFilePicker.806059ae.js";import{_ as D}from"./BaseButton.060f3a5f.js";import{_ as fe}from"./BaseButtons.7d99a140.js";import{U as ge,_ as ve}from"./LayoutAuthenticated.ccaeb884.js";/* empty css             */import{U as P}from"./utilityMethods.d9c941ff.js";import{s as pe}from"./vue-color-kit.esm-bundler.3aec9a2e.js";import{r as _e}from"./regex.a06b4297.js";import{A as I}from"./AgencyController.9cb3c224.js";import{u as ye}from"./alerts.ef7819ba.js";import{R as be}from"./RegisterConstroller.4a580cee.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./BaseIcon.86eb869a.js";import"./LoginController.5d91ed5e.js";const he={class:"flex justify-between pb-5"},we={class:"flex gap-2 items-center"},ke={class:"lg:text-xl text-lg"},Ae={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ve={class:"flex flex-row"},Ce={style:{position:"relative"}},Ue={style:{position:"absolute"}},xe={class:"w-24 h-24"},Se=["src"],$e={class:"w-24 h-24"},qe=["src"],Be={class:"text-lg italic font-bold"},ll={__name:"CreateAgencyView",setup(Ee){ue().getUserRole();const w="https://chgsdev.shareity.com/",f=r(),m=r(),A=r(!1),O=Y(),k=ye(),V=r({}),j=r(!1),C=r(null),g=r(null),U=r(null),x=r(null),S=r(null),$=r(!1),p=r(!1),q=r(!1),B=r(!1),E=r(!1),i=M({showcolorpicker:!1,color:"",suckerCanvas:null,suckerArea:[],isSucking:!1}),e=M({name:"",email:"",website:"",address:"",description:"",img:"",imgBg:"",color:i.color}),z=M({color:"green",message:""}),_=Z(),Q=_.query.id?"Edit":"Create";v(()=>{j.value=!e.name||!e.email||!e.website||!e.description}),v(()=>e.name,()=>{e.name?(C.value=null,$.value=!0):(C.value="Required field",$.value=!1)}),v(()=>e.email,async()=>{if(!e.email)g.value="Required field",p.value=!1;else if(!_e.test(e.email.trim()))g.value="Invalid email",p.value=!1;else{let o={email:e.email};try{let l=await be.verifyEmail(o);g.value=null,p.value=!0,console.log("res :>> ",l)}catch(l){console.log(l),g.value=l.message,p.value=!1}}}),v(()=>e.address,()=>{e.address?(U.value=null,q.value=!0):(U.value="Required field",q.value=!1)}),v(()=>e.website,()=>{e.website?(x.value=null,B.value=!0):(x.value="Required field",B.value=!1)}),v(()=>e.description,()=>{e.description?(S.value=null,E.value=!0):(S.value="Required field",E.value=!1)});const T=o=>{i.color=o.hex},X=o=>{f.value=o},F=o=>{m.value=o};ee(async()=>{try{V.value=await ge.getMyProfile();const o=await I.getByUser(_.query.id);o&&(e.name=o.name||"",e.email=o.email||"",e.address=o.address||"",e.website=o.website||"",e.description=o.description||"",f.value=w+(o.img||""),m.value=w+(o.imgBg||""),i.color=o.color),console.log("imgbg:",m.value)}catch(o){console.error("Error fetching data:",o)}},[_.query.id]);const G=async()=>{let o=await P.verifyMedia(f.value,"agency");const l=await P.verifyMedia(m.value,"agency");if(_.query.id){e.img=o,e.imgBg=l;let u={idUsr:V.value.id,name:e.name,email:e.email,address:e.address,website:e.website,img:e.img,description:e.description,imgBg:e.imgBg,color:i.color};console.log("color",u.color),console.log("console nombre",u.name),I.update(_.query.id,u).then(y=>{try{k.createAlert({title:"Agency Updated!",icon:"$success",text:"the Agency has been Updated successfully!"}),O.push("/agencies")}catch(s){k.createAlert({title:"Error on Updated!",icon:"$warning",text:`${s}`}),console.log("Error en Updated agencie",s)}})}else{e.img=o,e.imgBg=l;let u=JSON.parse(JSON.stringify(e));u.idUsr=V.value.id,I.create(u).then(y=>{try{k.createAlert({title:"Agency Created!",icon:"$success",text:"the Agency has been created successfully!"}),O.push("/agencies")}catch(s){k.createAlert({title:"Error on create Agency",icon:"$warning",color:"red",text:`${s}`}),console.log("Error en create agencie",s)}}).catch(y=>{console.log("estoy aqui",y)})}};return(o,l)=>{const u=J("v-btn"),y=J("v-snackbar");return R(),le(ve,null,{default:t(()=>[a(de,null,{default:t(()=>[n("div",he,[n("div",we,[a(D,{to:"/agencies",icon:c(ie),color:"info","rounded-full":"",small:""},null,8,["icon"]),n("p",ke,W(c(Q))+" Agency",1)])]),a(me,{"is-form":"",class:"col-span-3",onSubmit:ae(G,["prevent"])},{footer:t(()=>[a(fe,{class:"justify-end"},{default:t(()=>[a(D,{color:"info",type:"submit",label:"Save",disabled:j.value||g.value},null,8,["disabled"])]),_:1})]),default:t(()=>[n("div",Ae,[a(d,{label:"Agency Name",err:C.value},{default:t(()=>[a(h,{modelValue:e.name,"onUpdate:modelValue":l[0]||(l[0]=s=>e.name=s),icon:c(ne),required:"",class:b([$.value?"clase1 green ":""])},null,8,["modelValue","icon","class"])]),_:1},8,["err"]),a(d,{label:"Agency contact Email",err:g.value},{default:t(()=>[a(h,{modelValue:e.email,"onUpdate:modelValue":l[1]||(l[1]=s=>e.email=s),icon:c(ce),type:"email",name:"email",required:"",autocomplete:"email",label:"data",class:b([p.value?"clase2 green ":""])},null,8,["modelValue","icon","class"])]),_:1},8,["err"]),a(d,{label:"Agency address",err:U.value},{default:t(()=>[a(h,{modelValue:e.address,"onUpdate:modelValue":l[2]||(l[2]=s=>e.address=s),icon:c(N),class:b([q.value?"clase1 green ":""])},null,8,["modelValue","icon","class"])]),_:1},8,["err"]),a(d,{label:"Agency website",err:x.value},{default:t(()=>[a(h,{modelValue:e.website,"onUpdate:modelValue":l[3]||(l[3]=s=>e.website=s),icon:c(N),class:b([B.value?"clase1 green ":""])},null,8,["modelValue","icon","class"])]),_:1},8,["err"]),a(d,{label:"Agency Description",err:S.value},{default:t(()=>[a(h,{modelValue:e.description,"onUpdate:modelValue":l[4]||(l[4]=s=>e.description=s),icon:c(N),class:b([E.value?"clase1 green ":""])},null,8,["modelValue","icon","class"])]),_:1},8,["err"]),a(d,{label:"Agency Color"},{default:t(()=>[n("div",Ve,[a(D,{onClick:l[5]||(l[5]=s=>i.showcolorpicker=!i.showcolorpicker),class:"text-black w-full",label:"Select Color"}),n("div",{class:"ml-2 h-12 w-24 rounded-md",style:oe({background:i.color})},null,4)]),n("div",Ce,[se(n("div",Ue,[a(c(pe),{theme:"light",color:i.color,"sucker-hide":!1,"sucker-canvas":i.suckerCanvas,"sucker-area":i.suckerArea,onChangeColor:T,onOpenSucker:i.openSucker},null,8,["color","sucker-canvas","sucker-area","onOpenSucker"])],512),[[te,i.showcolorpicker]])])]),_:1}),a(d,{label:"Select Agency Image"},{default:t(()=>[a(L,{modelValue:f.value,"onUpdate:modelValue":X,label:"Upload",mediaClass:"h-52 w-52"},null,8,["modelValue"])]),_:1}),n("div",xe,[f.value!=null?(R(),H("img",{key:0,src:c(w)+f.value,alt:""},null,8,Se)):K("",!0)]),a(d,{label:"Select Agency Image Background"},{default:t(()=>[a(L,{modelValue:m.value,"onUpdate:modelValue":F,label:"Upload",mediaClass:"h-52 w-52"},null,8,["modelValue"])]),_:1}),n("div",$e,[m.value!=null?(R(),H("img",{key:0,src:c(w)+m.value,alt:""},null,8,qe)):K("",!0)])])]),_:1}),a(y,{modelValue:A.value,"onUpdate:modelValue":l[7]||(l[7]=s=>A.value=s),timeout:3e3,color:z.color},{actions:t(()=>[a(u,{color:"white",variant:"text",onClick:l[6]||(l[6]=s=>A.value=!1)},{default:t(()=>[re(" Close ")]),_:1})]),default:t(()=>[n("p",Be,W(z.message),1)]),_:1},8,["modelValue","color"])]),_:1})]),_:1})}}};export{ll as default};
