import{a as s,P as G,Q as K,r as Q,M as m,o as A,c as D,w as o,b as t,g as c,e as j,K as i,t as I,d as R,h as z,ac as H}from"./index.8eef5a34.js";import{S as N,M as J}from"./ServerCall.bf212017.js";import{_ as W}from"./NavBar.1d7fa6fb.js";import{_ as X}from"./CardBox.b1a10a53.js";import{_ as w}from"./FormField.8a5b2723.js";import{_ as T}from"./FormControl.b755056f.js";import{_ as B}from"./BaseButton.060f3a5f.js";import{_ as Z}from"./BaseButtons.7d99a140.js";import{U as E,_ as ee}from"./LayoutAuthenticated.ccaeb884.js";/* empty css             */import{_ as b}from"./FormCheckRadio.f7560f81.js";import{C as le}from"./ChallengeController.31bb59b5.js";import{u as te}from"./alerts.ef7819ba.js";import"./session.f47d2680.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./BaseIcon.86eb869a.js";import"./LoginController.5d91ed5e.js";const q={sendComunity:async(v,n)=>{let d={messageCommunity:n};delete n.challenge,console.log("input",n);try{return(await N.post(`/community/community-create-message/${v}`,d)).data}catch(r){throw r}},SmsComunnuty:async(v,n)=>{try{return(await N.post(`/community/community-sms/${v}`,n)).data}catch(d){throw d}}},oe={class:"flex justify-between pb-5"},ae={class:"flex gap-2 items-center"},se=c("p",{class:"lg:text-xl text-lg"},"Community Message",-1),ne=c("b",null,"Send",-1),re={class:"flex flex-column items-center justify-center flex-wrap gap-3 p-5"},ie={class:"gap-3"},ue={class:"flex flex-col gap-5"},me=c("p",{class:"text-lg italic font-bold"},"Mensaje Enviado",-1),$e={__name:"ComunityMessageView",setup(v){const n=s({}),d=s(),r=s(!1),S=s(),P=s(1);s();const _=s(),L=s(),V=s(null),C=te(),x=s(!1);G(async()=>{n.value=await E.getMyProfile(),d.value=n.value.rol,S.value=await E.getCredit(n.value.id),console.log(S.value.credits)}),K(()=>{console.log(n.value),le.getChallengeDashboard().then(f=>{console.log(f),f.forEach(e=>{h.value.push({id:e.id,label:e.name,userChallenges:e.userChallenges})}),console.log("mensaje de prueba",h.value)})});const h=s([]),g=s(!1),l=Q({challenge:h[0],message:"",test:!0,link:!1,sms:!1,community:!1}),O=()=>{if(!l.sms&&!l.community){console.error("Debes seleccionar al menos SMS o Inside Community."),C.createAlert({title:"Select SMS or Community!",icon:"$success",text:"You must select at least SMS or Inside Community.!",color:"red"});return}if(!l.challenge){console.error("Debes seleccionar un desaf\xEDo."),C.createAlert({title:"Select a challenge!",icon:"$success",text:"You must select a challenge..!",color:"red"});return}_.value=l.challenge.userChallenges.length,r.value=!0},Y=()=>{if(r.value=!1,console.log("CONFIRMSEND"),console.log("Profile.value",n.value.credits),l.sms&&l.challenge){let f=l.challenge.id,e={message:l.message,test:l.test,link:l.link};console.log(l.challenge.userChallenges),L.value=P.value*_.value,q.SmsComunnuty(f,e).then(u=>{g.value=!0,l.message="",console.log("Aqui",r.value)}).catch(u=>{let y=u.response.data.message;V.value=y,C.createAlert({title:"Insufficient credits",color:"error",icon:"$warning",text:y})}),console.log("prueba",l.sms)}if(l.community&&l.challenge){let f=l.challenge.id;q.sendComunity(f,l.message).then(e=>{g.value=!0,l.message=""}).catch(e=>{let u=e.response.data.message;V.value=u,C.createAlert({title:"Insufficient credits",color:"error",icon:"$warning",text:u})})}};return console.log("mensaje3",_.value),(f,e)=>{const u=m("v-card-title"),y=m("v-card-text"),k=m("v-spacer"),p=m("v-btn"),M=m("v-card-actions"),$=m("v-card"),U=m("v-dialog"),F=m("v-snackbar");return A(),D(ee,null,{default:o(()=>[t(W,null,{default:o(()=>[c("div",oe,[c("div",ae,[t(B,{icon:j(J),to:"/dashboard",color:"info","rounded-full":"",small:""},null,8,["icon"]),se])]),t(U,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value=a),width:"auto"},{default:o(()=>[t($,null,{default:o(()=>[t(u,{class:"text-h5"},{default:o(()=>[i(" Send Message? ")]),_:1}),t(y,null,{default:o(()=>[i(" Are you sure you want to "),ne,i(" this message to "+I(_.value)+" members of the community? ",1)]),_:1}),t(M,null,{default:o(()=>[t(k),t(p,{color:"red",red:"",variant:"text",onClick:e[0]||(e[0]=a=>r.value=!1)},{default:o(()=>[i(" Cancel ")]),_:1}),t(p,{color:"green-darken-1",variant:"text",onClick:Y},{default:o(()=>[i(" Ok ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(U,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=a=>x.value=a),width:"auto"},{default:o(()=>[t($,null,{default:o(()=>[t(u,{class:"text-4xl font-bold pt-5"},{default:o(()=>[i(I(V.value),1)]),_:1}),c("div",re,[t(M,null,{default:o(()=>[t(k),t(p,{class:"mr-2",color:"red-darken-1",variant:"text",onClick:e[2]||(e[2]=a=>x.value=!1)},{default:o(()=>[i(" Cancel ")]),_:1}),t(p,{class:"mr-2",color:"green-darken-1",variant:"text",onClick:e[3]||(e[3]=()=>j(H).push("/credits"))},{default:o(()=>[i(" Get Credits ")]),_:1})]),_:1})])]),_:1})]),_:1},8,["modelValue"]),t(X,{"is-form":"",class:"col-span-3",onSubmit:R(O,["prevent"])},{footer:o(()=>[t(Z,{class:"justify-end"},{default:o(()=>[t(B,{color:"info",type:"submit",label:"Send"})]),_:1})]),default:o(()=>[c("div",ie,[t(w,{label:"Challenge"},{default:o(()=>[t(T,{modelValue:l.challenge,"onUpdate:modelValue":e[5]||(e[5]=a=>l.challenge=a),value:"Select challenge",options:h.value,required:""},null,8,["modelValue","options"])]),_:1}),t(w,null,{default:o(()=>[c("div",ue,[d.value==="admin"?(A(),D(b,{key:0,label:"Test message: This notification will be send only to approved test accounts",modelValue:l.test,"onUpdate:modelValue":e[6]||(e[6]=a=>l.test=a)},null,8,["modelValue"])):z("",!0),t(b,{label:"Send challenge link: This notification will cointain the link to the user challenge",modelValue:l.link,"onUpdate:modelValue":e[7]||(e[7]=a=>l.link=a)},null,8,["modelValue"]),t(b,{label:"SMS: This notification will be sent via SMS, credits will be charged",modelValue:l.sms,"onUpdate:modelValue":e[8]||(e[8]=a=>l.sms=a)},null,8,["modelValue"]),t(b,{label:"Inside Community: This notification will be shown on the inside community feed",modelValue:l.community,"onUpdate:modelValue":e[9]||(e[9]=a=>l.community=a)},null,8,["modelValue"])])]),_:1}),t(w,{label:"Message"},{default:o(()=>[t(T,{textarea:"",modelValue:l.message,"onUpdate:modelValue":e[10]||(e[10]=a=>l.message=a),required:""},null,8,["modelValue"])]),_:1})])]),_:1}),t(F,{modelValue:g.value,"onUpdate:modelValue":e[12]||(e[12]=a=>g.value=a),timeout:3e3,color:"green"},{actions:o(()=>[t(p,{color:"white",variant:"text",onClick:e[11]||(e[11]=a=>g.value=!1)},{default:o(()=>[i(" Close ")]),_:1})]),default:o(()=>[me]),_:1},8,["modelValue"])]),_:1})]),_:1})}}};export{$e as default};
